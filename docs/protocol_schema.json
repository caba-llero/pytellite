{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Protocol Message",
  "anyOf": [
    { "$ref": "#/$defs/sensor-gyro-v1" },
    { "$ref": "#/$defs/sensor-gps-v1" }
  ],
  "$defs": {
    "sensor-gyro-v1": {
      "type": "object",
      "required": ["type", "protocol_version", "schema_version", "sensor", "t_sim", "payload"],
      "properties": {
        "type": { "const": "sensor" },
        "protocol_version": { "type": "string" },
        "schema_version": { "const": "gyro-v1" },
        "sensor": { "const": "gyro" },
        "t_sim": { "type": "number" },
        "t_sent": { "type": ["string", "null"] },
        "seq": { "type": ["integer", "null"] },
        "payload": {
          "type": "object",
          "required": ["omega_body"],
          "properties": {
            "omega_body": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3
            },
            "cov": {
              "type": "array",
              "items": {
                "type": "array",
                "items": { "type": "number" },
                "minItems": 3,
                "maxItems": 3
              },
              "minItems": 3,
              "maxItems": 3
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "sensor-gps-v1": {
      "type": "object",
      "required": ["type", "protocol_version", "schema_version", "sensor", "t_sim", "payload"],
      "properties": {
        "type": { "const": "sensor" },
        "protocol_version": { "type": "string" },
        "schema_version": { "const": "gps-v1" },
        "sensor": { "const": "gps" },
        "t_sim": { "type": "number" },
        "t_sent": { "type": ["string", "null"] },
        "seq": { "type": ["integer", "null"] },
        "payload": {
          "type": "object",
          "required": ["r_eci", "v_eci"],
          "properties": {
            "r_eci": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3
            },
            "v_eci": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 3,
              "maxItems": 3
            },
            "cov": {
              "type": "array",
              "items": {
                "type": "array",
                "items": { "type": "number" }
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}
